<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="9/4/2013 2:33:16 PM"
  DTS:CreationName="SSIS.Package.3"
  DTS:CreatorComputerName="IMONCIVAIS-L7"
  DTS:CreatorName="CORPHQ\IMoncivais"
  DTS:DTSID="{E03A8880-9D62-485B-831D-6053ED54351C}"
  DTS:ExecutableType="SSIS.Package.3"
  DTS:LastModifiedProductVersion="11.0.5583.0"
  DTS:LocaleID="1033"
  DTS:ObjectName="Create - Cube Data"
  DTS:PackageType="5"
  DTS:VersionBuild="15"
  DTS:VersionGUID="{E95F9F48-BC6E-47E8-9FFF-029970BF70CC}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">6</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[HQ-FINSQL-01.DW.SSISUser]"
      DTS:CreationName="OLEDB"
      DTS:DTSID="{D5206406-C1E0-4834-949E-68B9E38230B8}"
      DTS:ObjectName="HQ-FINSQL-01.DW.SSISUser">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=HQ-FINSQL-01;User ID=SSISUser;Initial Catalog=DW;Provider=SQLNCLI11.1;Persist Security Info=True;Auto Translate=False;">
          <DTS:Password
            DTS:Name="Password"
            Sensitive="1"
            Encrypted="1">AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAqsTtXOlYhUqQ6fHLEu5q4AAAAAAIAAAARABUAFMAAAADZgAAwAAAABAAAACiaLQXWy+ZwuzJtFZhDgOpAAAAAASAAACgAAAAEAAAAKuWsMkDjNU5A2ieXkaAfiIoAAAACUXrF0/L+K0i6FEq6I7ruEgpMFJdGtMQaAqFvoQxy0kZLXt3kIm4MRQAAABmZYP2Fo7u0/4ZLMtWLJ/+em/gew</DTS:Password>
        </DTS:ConnectionManager>
      </DTS:ObjectData>
    </DTS:ConnectionManager>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[SMTP]"
      DTS:CreationName="SMTP"
      DTS:DTSID="{40B3A907-2FA2-4037-90FA-29573698AF5B}"
      DTS:ObjectName="SMTP">
      <DTS:ObjectData>
        <SmtpConnectionManager
          ConnectionString="SmtpServer=smtp.redrobin.com;UseWindowsAuthentication=True;EnableSsl=False;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:Variables />
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Create Cube Data"
      DTS:CreationName="Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{6CF02DCE-FCF8-4FBD-93FB-B5814D39C343}"
      DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91"
      DTS:LocaleID="-1"
      DTS:ObjectName="Create Cube Data"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2012; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{D5206406-C1E0-4834-949E-68B9E38230B8}"
          SQLTask:SqlStatementSource="USE DW&#xA;GO&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'dbo.pre_Royalty_Cube_Data1_tab'))&#xA;DROP TABLE dbo.pre_Royalty_Cube_Data1_tab;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;pre_Royalty_Cube_Data1_tab&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;LoyaltyID&#x9;&#x9;&#x9;&#x9;VARCHAR(14)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NOT NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ProfileAddDate&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ActivationDate&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID&#x9;&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NOT NUll,&#xA;&#x9;&#x9;&#x9;&#x9;CheckNumber&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;CheckTotal&#x9;&#x9;&#x9;&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardAmountRedeemed&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;TheEvent&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;DateOfBusiness&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL&#xA;&#x9;&#x9;&#x9;);&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;INSERT INTO pre_Royalty_Cube_Data1_tab&#xA;&#x9;&#x9;&#x9;(&#x9;LoyaltyID&#xA;&#x9;&#x9;      , RewardProgramName&#xA;&#x9;&#x9;      , RewardProgramID&#xA;&#x9;&#x9;      , ProfileAddDate&#xA;&#x9;&#x9;&#x9;  , ActivationDate&#xA;&#x9;&#x9;      , SalesMixDate&#xA;&#x9;&#x9;      , StoreID&#xA;&#x9;&#x9;      , CheckNumber&#xA;&#x9;&#x9;      , CheckTotal&#xA;&#x9;&#x9;      , RewardAmountRedeemed&#xA;&#x9;&#x9;      , TheEvent&#xA;&#x9;&#x9;&#x9;  , DateOfBusiness&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;  SELECT&#x9;a.CardNumber                                                                    AS&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;f.RewardProgramName,&#xA;       &#x9;&#x9;&#x9;&#x9;f.vbofqRewardProgramID&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;a.ProfileAddedDateTime&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;ProfileAddDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ss.ActivityDateTime&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;ActivationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;b.ActivityDateTime&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;b.FKStoreID&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;StoreId,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;c.CheckNumber,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;c.CheckTotal,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;d.RewardAmount&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;RewardAmountRedeemed,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;d.[Event]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;TheEvent,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;b.DateOfBusiness&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;FROM&#x9;vbofqMemberAccount&#x9;&#x9;&#x9;a&#xA;&#x9;  INNER JOIN&#x9;HstvbofqAssignment&#x9;&#x9;&#x9;b&#x9;ON&#x9;a.vbofqMemberAccountID&#x9;&#x9;&#x9;=&#x9;&#x9;b.FKvbofqMemberAccountID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND&#x9;b.[Status]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;&#x9;4&#xA;&#x9;  INNER JOIN&#x9;HstvbofqCheck&#x9;&#x9;&#x9;&#x9;c&#x9;ON&#x9;b.HstvbofqAssignmentID&#x9;&#x9;&#x9;=&#x9;&#x9;c.FKHstvbofqAssignmentID&#xA;&#x9;  INNER JOIN&#x9;HstvbofqAssignmentReward&#x9;d&#x9;ON&#x9;b.HstvbofqAssignmentID&#x9;&#x9;&#x9;=&#x9;&#x9;d.FKHstvbofqAssignmentID&#xA;&#x9;  INNER JOIN&#x9;HstvbofqRewardProgram&#x9;&#x9;e&#x9;ON&#x9;d.FKHstvbofqRewardProgramID&#x9;&#x9;=&#x9;&#x9;e.HstvbofqRewardProgramID&#xA;&#x9;  INNER JOIN&#x9;vbofqRewardProgram&#x9;&#x9;&#x9;f&#x9;ON&#x9;e.FKvbofqRewardProgramID&#x9;&#x9;=&#x9;&#x9;f.vbofqRewardProgramID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND&#x9;f.RewardProgramName&#x9;&#x9;&#x9;&#x9;LIKE&#x9;'Royalty%'&#xA;&#x9;  INNER JOIN&#x9;staging_GetFirstActivationRecords_tab&#x9;ss&#x9;ON&#x9;a.vbofqMemberAccountID =&#x9;ss.vbofqMemberAccountID&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;   WHERE&#x9;CONVERT(DATE, b.DateOfBusiness)&#x9;&gt;&#x9;CONVERT(DATE, (GETDATE()-1127))&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;ORDER BY&#x9;f.vbofqRewardProgramID,&#x9;&#x9;b.DateOfBusiness,&#x9;&#x9;b.FKStoreID,&#x9;c.CheckNumber;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;CHECKPOINT;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'dbo.pre_Royalty_Cube_Data2_tab'))&#xA;DROP TABLE dbo.pre_Royalty_Cube_Data2_tab;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;pre_Royalty_Cube_Data2_tab&#xA;&#x9;&#x9;&#x9;(&#x9;LoyaltyID&#x9;&#x9;&#x9;&#x9;VARCHAR(14)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NOT NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ProfileAddDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ActivationDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;DateOfBusiness&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID&#x9;&#x9;&#x9;&#x9;&#x9;VARCHAR(5)&#x9;&#x9;NOT NUll,&#xA;&#x9;&#x9;&#x9;&#x9;CheckNumber&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;CheckTotal&#x9;&#x9;&#x9;&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardAmountRedeemed&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardEvent3&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardEvent1&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL&#xA;&#x9;&#x9;&#x9;);&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;INSERT INTO pre_Royalty_Cube_Data2_tab&#xA;&#x9;&#x9;&#x9;(&#x9;LoyaltyID&#xA;&#x9;&#x9;      , RewardProgramName&#xA;&#x9;&#x9;      , RewardProgramID&#xA;&#x9;&#x9;      , ProfileAddDate&#xA;&#x9;&#x9;&#x9;  , ActivationDate&#xA;&#x9;&#x9;      , SalesMixDate&#xA;&#x9;&#x9;&#x9;  , DateOfBusiness&#xA;&#x9;&#x9;      , StoreID&#xA;&#x9;&#x9;      , CheckNumber&#xA;&#x9;&#x9;      , CheckTotal&#xA;&#x9;&#x9;      , RewardAmountRedeemed&#xA;&#x9;&#x9;      , RewardEvent3&#xA;&#x9;&#x9;      , RewardEvent1&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;  SELECT&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE  WHEN  SalesMixDate&#x9;&#x9;&#x9;&lt;&#x9;'10/18/2010'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND  RewardProgramName&#x9;&#x9;=&#x9;'Royalty Buy 9, Get 10th Free'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  THEN&#x9;'Royalty-Buy12'&#x9;&#x9; ELSE&#x9;RewardProgramName&#x9;&#x9;&#x9;END&#x9;&#x9;&#x9;AS&#x9;RewardProgramName,&#xA;       &#x9;&#x9;&#x9;&#x9;CASE  WHEN&#x9;SalesMixDate&#x9;&#x9;&#x9;&lt;&#x9;'10/18/2010'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND&#x9;RewardProgramID&#x9;&#x9;&#x9;=&#x9;7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  THEN&#x9;303&#x9;&#x9;&#x9;&#x9;&#x9; ELSE&#x9;RewardProgramID&#x9;&#x9;&#x9;&#x9;END&#x9;&#x9;&#x9;AS&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, ProfileAddDate, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;ProfileAddDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, ActivationDate, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;ActivationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, SalesMixDate, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RIGHT(REPLICATE('0',3) + CONVERT(VARCHAR, StoreId) ,3)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;StoreId,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CheckNumber,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CheckTotal,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SUM(RewardAmountRedeemed)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;RewardAmountRedeemed,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;1                                                                               AS&#x9;RewardEvent3,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;0                                                                               AS&#x9;RewardEvent1&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;FROM&#x9;pre_Royalty_Cube_Data1_tab&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;   WHERE&#x9;TheEvent&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;3&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;GROUP BY&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE  WHEN  SalesMixDate&#x9;&#x9;&#x9;&lt;&#x9;'10/18/2010'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND  RewardProgramName&#x9;&#x9;=&#x9;'Royalty Buy 9, Get 10th Free'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  THEN&#x9;'Royalty-Buy12'&#x9;&#x9; ELSE&#x9;RewardProgramName&#x9;&#x9;&#x9;END,&#xA;       &#x9;&#x9;&#x9;&#x9;CASE  WHEN&#x9;SalesMixDate&#x9;&#x9;&#x9;&lt;&#x9;'10/18/2010'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND&#x9;RewardProgramID&#x9;&#x9;&#x9;=&#x9;7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  THEN&#x9;303&#x9;&#x9;&#x9;&#x9;&#x9; ELSE&#x9;RewardProgramID&#x9;&#x9;&#x9;&#x9;END,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, ProfileAddDate, 112),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, ActivationDate, 112),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, SalesMixDate, 112),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RIGHT(REPLICATE('0',3) + CONVERT(VARCHAR, StoreId) ,3),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CheckNumber,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CheckTotal,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE  WHEN&#x9;TheEvent&#x9;&#x9;&#x9;&#x9;=&#x9;3&#x9;THEN&#x9;1&#x9;ELSE&#x9;0&#x9;END&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;ORDER BY&#x9;RewardProgramID,&#x9;&#x9;DateOfBusiness,&#x9;&#x9;StoreID,&#x9;CheckNumber;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;CHECKPOINT;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'dbo.pre_Royalty_Cube_Data3_tab'))&#xA;DROP TABLE dbo.pre_Royalty_Cube_Data3_tab;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;pre_Royalty_Cube_Data3_tab&#xA;&#x9;&#x9;&#x9;(&#x9;LoyaltyID&#x9;&#x9;&#x9;&#x9;VARCHAR(14)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NOT NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ProfileAddDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ActivationDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;DateOfBusiness&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID&#x9;&#x9;&#x9;&#x9;&#x9;VARCHAR(5)&#x9;&#x9;NOT NUll,&#xA;&#x9;&#x9;&#x9;&#x9;CheckNumber&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;CheckTotal&#x9;&#x9;&#x9;&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardAmountRedeemed&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardEvent3&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardEvent1&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL&#xA;&#x9;&#x9;&#x9;);&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;INSERT INTO pre_Royalty_Cube_Data3_tab&#xA;&#x9;&#x9;&#x9;(&#x9;LoyaltyID&#xA;&#x9;&#x9;      , RewardProgramName&#xA;&#x9;&#x9;      , RewardProgramID&#xA;&#x9;&#x9;      , ProfileAddDate&#xA;&#x9;&#x9;&#x9;  , ActivationDate&#xA;&#x9;&#x9;      , SalesMixDate&#xA;  &#x9;&#x9;&#x9;  , DateOfBusiness&#xA;&#x9;&#x9;      , StoreID&#xA;&#x9;&#x9;      , CheckNumber&#xA;&#x9;&#x9;      , CheckTotal&#xA;&#x9;&#x9;      , RewardAmountRedeemed&#xA;&#x9;&#x9;      , RewardEvent3&#xA;&#x9;&#x9;      , RewardEvent1&#xA;&#x9;&#x9;&#x9;)&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;  SELECT&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE  WHEN  SalesMixDate&#x9;&#x9;&#x9;&lt;&#x9;'10/18/2010'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND  RewardProgramName&#x9;&#x9;=&#x9;'Royalty Buy 9, Get 10th Free'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  THEN&#x9;'Royalty-Buy12'&#x9;&#x9; ELSE&#x9;RewardProgramName&#x9;&#x9;&#x9;END&#x9;&#x9;&#x9;AS&#x9;RewardProgramName,&#xA;       &#x9;&#x9;&#x9;&#x9;CASE  WHEN&#x9;SalesMixDate&#x9;&#x9;&#x9;&lt;&#x9;'10/18/2010'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND&#x9;RewardProgramID&#x9;&#x9;&#x9;=&#x9;7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  THEN&#x9;303&#x9;&#x9;&#x9;&#x9;&#x9; ELSE&#x9;RewardProgramID&#x9;&#x9;&#x9;&#x9;END&#x9;&#x9;&#x9;AS&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, ProfileAddDate, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;ProfileAddDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, ActivationDate, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;ActivationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, SalesMixDate, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RIGHT(REPLICATE('0',3) + CONVERT(VARCHAR, StoreId) ,3)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;StoreId,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CheckNumber,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;0&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;CheckTotal,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SUM(CASE  WHEN  TheEvent  =  3  THEN  RewardAmountRedeemed  ELSE  0  END)&#x9;&#x9;AS&#x9;RewardAmountRedeemed,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;0&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;RewardEvent3,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#x9;  WHEN&#x9;TheEvent  =  1  THEN  1&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE  0  END&#x9;&#x9;AS&#x9;RewardEvent1&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;FROM&#x9;pre_Royalty_Cube_Data1_tab&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;   WHERE&#x9;TheEvent&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;1&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;GROUP BY&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE  WHEN  SalesMixDate&#x9;&#x9;&#x9;&lt;&#x9;'10/18/2010'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND  RewardProgramName&#x9;&#x9;=&#x9;'Royalty Buy 9, Get 10th Free'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  THEN&#x9;'Royalty-Buy12'&#x9;&#x9; ELSE&#x9;RewardProgramName&#x9;&#x9;&#x9;END,&#xA;       &#x9;&#x9;&#x9;&#x9;CASE  WHEN&#x9;SalesMixDate&#x9;&#x9;&#x9;&lt;&#x9;'10/18/2010'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   AND&#x9;RewardProgramID&#x9;&#x9;&#x9;=&#x9;7&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  THEN&#x9;303&#x9;&#x9;&#x9;&#x9;&#x9; ELSE&#x9;RewardProgramID&#x9;&#x9;&#x9;&#x9;END,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, ProfileAddDate, 112),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, ActivationDate, 112),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;convert(VARCHAR, SalesMixDate, 112),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RIGHT(REPLICATE('0',3) + CONVERT(VARCHAR, StoreId) ,3),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CheckNumber,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CheckTotal,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE  WHEN&#x9;TheEvent&#x9;&#x9;&#x9;&#x9;=&#x9;1&#x9;THEN&#x9;1&#x9;ELSE&#x9;0&#x9;END&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;ORDER BY&#x9;RewardProgramID,&#x9;&#x9;DateOfBusiness,&#x9;&#x9;StoreID,&#x9;CheckNumber;&#xA;--==============================================================================================================================&#xA;&#xA;CHECKPOINT;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'dbo.Royalty_Cube_Data'))&#xA;DROP TABLE dbo.Royalty_Cube_Data;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;Royalty_Cube_Data&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;LoyaltyID&#x9;&#x9;&#x9;&#x9;VARCHAR(14)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NOT NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ProfileAddDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ActivationDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;DateOfBusiness&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NOT NULL,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID&#x9;&#x9;&#x9;&#x9;&#x9;VARCHAR(5)&#x9;&#x9;NOT NUll,&#xA;&#x9;&#x9;&#x9;&#x9;CheckNumber&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardEvent3&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;CheckTotal&#x9;&#x9;&#x9;&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardAmountRedeemed&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardEvent1&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL&#xA;&#x9;&#x9;&#x9;);&#xA;&#x9;-------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;CREATE CLUSTERED INDEX idx_Customers_CustomerID&#xA;&#x9;ON Royalty_Cube_Data(RewardProgramName, DateOfBusiness, StoreID);&#xA;-----------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;INSERT INTO Royalty_Cube_Data&#xA;&#x9;&#x9;&#x9;&#x9;(&#x9;LoyaltyID&#xA;&#x9;&#x9;&#x9;&#x9;  , RewardProgramName&#xA;&#x9;&#x9;&#x9;&#x9;  , RewardProgramID&#xA;&#x9;&#x9;&#x9;&#x9;  , ProfileAddDate&#xA;&#x9;&#x9;&#x9;&#x9;  , ActivationDate&#xA;&#x9;&#x9;&#x9;&#x9;  , SalesMixDate&#xA;&#x9;&#x9;&#x9;&#x9;  , DateOfBusiness&#xA;&#x9;&#x9;&#x9;&#x9;  , StoreID&#xA;&#x9;&#x9;&#x9;&#x9;  , CheckNumber&#xA;&#x9;&#x9;&#x9;&#x9;  , CheckTotal&#xA;&#x9;&#x9;&#x9;&#x9;  , RewardAmountRedeemed&#xA;&#x9;&#x9;&#x9;&#x9;  , RewardEvent3&#xA;&#x9;&#x9;&#x9;&#x9;  , RewardEvent1&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;-------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;SELECT&#x9;&#x9;LoyaltyID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardProgramName&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardProgramID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , ProfileAddDate&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , ActivationDate&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , SalesMixDate&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , DateOfBusiness&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , StoreID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , CheckNumber&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , CheckTotal&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardAmountRedeemed&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardEvent3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardEvent1&#xA;&#x9;&#x9;&#x9;  FROM&#x9;&#x9;pre_Royalty_Cube_Data2_tab&#xA;&#x9;-------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;UNION ALL&#xA;&#x9;-------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;SELECT&#x9;&#x9;LoyaltyID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardProgramName&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardProgramID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , ProfileAddDate&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , ActivationDate&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , SalesMixDate&#xA;&#x9;  &#x9;&#x9;&#x9;&#x9;  , DateOfBusiness&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , StoreID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , CheckNumber&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , CheckTotal&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardAmountRedeemed&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardEvent3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  , RewardEvent1&#xA;&#x9;&#x9;&#x9;FROM&#x9;&#x9;pre_Royalty_Cube_Data3_tab;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;CHECKPOINT;&#xA;&#xA;--==============================================================================================================================&#xA;--==============================================================================================================================&#xA;&#xA;DROP TABLE&#x9;pre_Royalty_Cube_Data1_tab;&#xA;&#x9;&#xA;DROP TABLE&#x9;pre_Royalty_Cube_Data2_tab;&#xA;&#xA;DROP TABLE&#x9;pre_Royalty_Cube_Data3_tab;&#xA;&#xA;--==============================================================================================================================&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[pre_RoyaltyMeritData1_tab]'))&#xA;DROP TABLE [dbo].[pre_RoyaltyMeritData1_tab];&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;pre_RoyaltyMeritData1_tab&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#xA;&#x9;&#x9;&#x9;&#x9;LoyaltyID&#x9;&#x9;&#x9;&#x9;VARCHAR(14)&#x9;NOT&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate&#x9;&#x9;&#x9;DATETIME&#x9;NOT&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ActivityDateTime&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ProfileAddedDateTime&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;DateOfBusiness&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID&#x9;&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;NOT&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;Merit&#x9;&#x9;&#x9;&#x9;&#x9;FLOAT&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;CountatExpiration&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;Seq&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;[Status]&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;PRIMARY KEY&#x9;(IdentCol)&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;);&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;INSERT INTO&#x9;&#x9;pre_RoyaltyMeritData1_tab&#xA;&#x9;&#x9;&#x9;&#x9;(&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ActivityDateTime,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ProfileAddedDateTime,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;StoreID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Merit,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CountatExpiration,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Seq,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;[Status]&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;SELECT&#x9;vfmac.CardNumber&#x9;&#x9;&#x9;AS&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;vfrpr.RewardProgramName,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;vfrpr.vbofqRewardProgramID&#x9;AS&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;hvfas.ActivityDateTime&#x9;&#x9;AS&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;accrd.ActivityDateTime,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;vfmac.ProfileAddedDateTime,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;hvfas.DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;hvfas.FKStoreID&#x9;&#x9;&#x9;&#x9;AS&#x9;StoreID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;hvfam.MeritAmount&#x9;&#x9;&#x9;AS&#x9;Merit,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;0&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;CountatExpiration,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ROW_NUMBER() OVER(Partition by  vfmac.CardNumber Order by hvfas.ActivityDateTime) as Seq,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;hvfas.[Status]&#xA;&#x9;&#x9;------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;  FROM&#x9;vbofqMemberAccount&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;vfmac,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;HstvbofqAssignment&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;hvfas,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;HstvbofqAssignmentMerit&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;hvfam,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;HstvbofqRewardProgram&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;hvfrp,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;vbofqRewardProgram&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;vfrpr,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(&#x9;SELECT&#x9;z.FKvbofqMemberAccountID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;MIN(z.ActivityDateTime)&#x9;&#x9;&#x9;AS&#x9;ActivityDateTime&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  FROM&#x9;vbofqMemberAccount&#x9;&#x9;&#x9;&#x9;y,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;HstvbofqAssignment&#x9;&#x9;&#x9;&#x9;z&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; WHERE&#x9;y.vbofqMemberAccountID&#x9;&#x9;&#x9;=&#x9;z.FKvbofqMemberAccountID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;  GROUP BY&#x9;z.FKvbofqMemberAccountID&#x9;&#x9;)&#x9;accrd&#xA;&#x9;&#x9;------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9; WHERE&#x9;vfmac.vbofqMemberAccountID&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;hvfas.FKvbofqMemberAccountID&#xA;&#x9;&#x9;&#x9;   AND&#x9;vfmac.vbofqMemberAccountID&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;accrd.FKvbofqMemberAccountID&#xA;&#x9;&#x9;&#x9;   AND&#x9;hvfas.HstvbofqAssignmentID&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;hvfam.FKHstvbofqAssignmentID&#xA;&#x9;&#x9;&#x9;   AND&#x9;hvfam.FKHstvbofqRewardProgramID&#x9;&#x9;&#x9;&#x9;=&#x9;hvfrp.HstvbofqRewardProgramID&#xA;&#x9;&#x9;&#x9;   AND&#x9;hvfrp.FKvbofqRewardProgramID&#x9;&#x9;&#x9;&#x9;=&#x9;vfrpr.vbofqRewardProgramID&#xA;&#x9;&#x9;&#x9;   AND&#x9;vfmac.vbofqMemberAccountID&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;accrd.FKvbofqMemberAccountID&#xA;&#x9;&#x9;&#x9;   AND&#x9;CONVERT(DATE, hvfas.DateOfBusiness)&#x9;&#x9;&#x9;&gt;&#x9;CONVERT(DATE, (GETDATE()-397))&#xA;&#x9;&#x9;&#x9;   AND&#x9;hvfas.[Status]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;4&#xA;&#x9;&#x9;&#x9;   AND&#x9;vfrpr.vbofqRewardProgramID&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;34&#xA;&#x9;&#x9;------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;  ORDER BY&#x9;vfrpr.vbofqRewardProgramID, hvfas.DateOfBusiness, hvfas.FKStoreID;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;CHECKPOINT;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[pre_RoyaltyMeritData2_tab]'))&#xA;DROP TABLE [dbo].pre_RoyaltyMeritData2_tab;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;pre_RoyaltyMeritData2_tab&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#xA;&#x9;&#x9;&#x9;&#x9;LoyaltyID&#x9;&#x9;&#x9;&#x9;VARCHAR(14)&#x9;NOT&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate&#x9;&#x9;&#x9;DATETIME&#x9;NOT&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ActivationDate&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ExpirationDate&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;DateOfBusiness&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID&#x9;&#x9;&#x9;&#x9;&#x9;VARCHAR(5)&#x9;NOT&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;Merit&#x9;&#x9;&#x9;&#x9;&#x9;FLOAT&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;CountatExpiration&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;Seq&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;PRIMARY KEY&#x9;(IdentCol)&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;);&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;INSERT INTO&#x9;&#x9;pre_RoyaltyMeritData2_tab&#xA;&#x9;&#x9;&#x9;&#x9;(&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ActivationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ExpirationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;StoreID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Merit,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CountatExpiration,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Seq&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;SELECT&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CONVERT(varchar, SalesMixDate, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CONVERT(varchar, ActivityDateTime, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;ActivationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN ProfileAddedDateTime&#x9;IS NULL&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;DATEADD(dd,35,ActivityDateTime)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN ProfileAddedDateTime&#x9;&lt;&#x9;ActivityDateTime&#x9;THEN&#x9;DATEADD(dd,35,ProfileAddedDateTime)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#x9;DATEADD(dd,35,ActivityDateTime)&#x9;&#x9;&#x9;&#x9;END&#x9;&#x9;&#x9; &#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;ExpirationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RIGHT(REPLICATE('0',3) + CONVERT(VARCHAR, StoreID) ,3)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;StoreID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Merit,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#x9;WHEN ActivityDateTime &lt;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(CASE &#x9;WHEN ProfileAddedDateTime IS NULL&#x9;&#x9;&#x9;THEN&#x9;DATEADD(dd,35,ActivityDateTime)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN ProfileAddedDateTime&#x9;&lt;&#x9;ActivityDateTime&#x9;THEN&#x9;DATEADD(dd,35,ProfileAddedDateTime)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#x9;DATEADD(dd,35,ActivityDateTime)&#x9;&#x9;&#x9;&#x9;END)&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;Merit&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#x9;0&#x9;&#x9;END&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;CountatExpiration,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Seq&#xA;&#x9;&#x9;------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;  FROM&#x9;pre_RoyaltyMeritData1_tab&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;CHECKPOINT;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Royalty_Cube_Merit]'))&#xA;DROP TABLE [dbo].Royalty_Cube_Merit;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;Royalty_Cube_Merit&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#xA;&#x9;&#x9;&#x9;&#x9;LoyaltyID&#x9;&#x9;&#x9;&#x9;VARCHAR(14)&#x9;NOT&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate&#x9;&#x9;&#x9;DATETIME&#x9;NOT&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ActivationDate&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ExpirationDate&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;DateOfBusiness&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID&#x9;&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;NOT&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;Merit&#x9;&#x9;&#x9;&#x9;&#x9;FLOAT&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;CountatExpiration&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;PRIMARY KEY&#x9;(IdentCol)&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;);&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;INSERT INTO&#x9;&#x9;Royalty_Cube_Merit&#xA;&#x9;&#x9;&#x9;&#x9;(&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ActivationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ExpirationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;StoreID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Merit,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CountatExpiration&#xA;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;SELECT&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ActivationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ExpirationDate,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;DateOfBusiness,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;StoreID,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Merit,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;CASE&#x9;WHEN&#x9;( SELECT&#x9;SUM(CountatExpiration)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;FROM&#x9;pre_RoyaltyMeritData2_tab&#x9;t2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   WHERE&#x9;t2.LoyaltyID&#x9;&#x9;&#x9;=&#x9;t1.LoyaltyID&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;     AND&#x9;t1.Seq&#x9;&#x9;&#x9;&#x9;&#x9;&gt;=&#x9;t2.Seq)&#x9;&#x9;&#x9;&#x9;&#x9;&lt;=&#x9;5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;THEN&#x9;t1.CountatExpiration&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ELSE&#x9;0&#x9;END&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;CountatExpiration&#xA;&#x9;&#x9;------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;&#x9;&#x9;  FROM&#x9;pre_RoyaltyMeritData2_tab&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;t1&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;CHECKPOINT;&#xA;&#xA;DROP TABLE&#x9;pre_RoyaltyMeritData1_tab;&#xA;DROP TABLE&#x9;pre_RoyaltyMeritData2_tab;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'dbo.Royalty_Cube_Standings'))&#xA;DROP TABLE dbo.Royalty_Cube_Standings;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;Royalty_Cube_Standings&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;LoyaltyID&#x9;&#x9;&#x9;&#x9;VARCHAR(14)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;CommittedMerit&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;NextRewardThreshold&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL&#xA;&#x9;&#x9;&#x9;);&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;INSERT INTO dbo.Royalty_Cube_Standings&#xA;&#x9;&#x9;&#x9;(&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;CommittedMerit,&#xA;&#x9;&#x9;&#x9;&#x9;NextRewardThreshold&#xA;&#x9;&#x9;&#x9;)&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;SELECT  b.CardNumber&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;LoyaltyID,&#xA;&#x9;&#x9;&#x9;c.RewardProgramName&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;c.vbofqRewardProgramID&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;a.CommittedMerit&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;CommittedMerit,&#xA;&#x9;&#x9;&#x9;a.NextRewardThreshold -1&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;NextRewardThreshold&#x9;&#x9;&#x9;&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;FROM &#x9;vbofqRewardProgramStandings&#x9;&#x9;&#x9;&#x9;a,&#xA;&#x9;&#x9;&#x9;vbofqMemberAccount&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;b,&#xA;&#x9;&#x9;&#x9;vbofqRewardProgram&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;c&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;WHERE&#x9;a.FKvbofqMemberAccountID&#x9;&#x9;&#x9;&#x9;=&#x9;&#x9;b.vbofqMemberAccountID&#xA;&#x9;  AND&#x9;a.FKvbofqRewardProgramID&#x9;&#x9;&#x9;&#x9;=&#x9;&#x9;c.vbofqRewardProgramID&#xA;&#x9;  AND&#x9;CONVERT(DATE, b.ProfileAddedDateTime)&#x9;&gt;&#x9;&#x9;CONVERT(DATE, (GETDATE()-397));&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;CHECKPOINT;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'dbo.Royalty_Cube_OfflineComps'))&#xA;DROP TABLE dbo.Royalty_Cube_OfflineComps;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;Royalty_Cube_OfflineComps&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID&#x9;&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NUll,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate&#x9;&#x9;&#x9;DATETIME&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;MgrCompAmt&#x9;&#x9;&#x9;&#x9;FLOAT&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;CountofMgrComp&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL&#xA;&#x9;&#x9;&#x9;);&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;INSERT INTO dbo.Royalty_Cube_OfflineComps&#xA;&#x9;&#x9;&#x9;(&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;&#x9;StoreID,&#xA;&#x9;&#x9;&#x9;&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;&#x9;MgrCompAmt,&#xA;&#x9;&#x9;&#x9;&#x9;CountofMgrComp&#xA;&#x9;&#x9;&#x9;)&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;SELECT  a.ID&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;b.PromoDesc&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;RewardProgramName,&#xA;&#x9;&#x9;&#x9;a.RestID&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;StoreId,&#xA;&#x9;&#x9;&#x9;a.SalesDate&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;SalesMixDate,&#xA;&#x9;&#x9;&#x9;a.IDAmt&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;MgrCompAmt,&#xA;&#x9;&#x9;&#x9;1&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;&#x9;CountofMgrComp&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;FROM &#x9;PromoDetails&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;a,&#xA;&#x9;&#x9;&#x9;PromoDesc&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;b&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;WHERE&#x9;a.ID&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;&#x9;b.PromoID&#xA;&#x9;  AND&#x9;a.ID&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;BETWEEN&#x9;40 AND 49;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'dbo.Royalty_Cube_RewardProgram'))&#xA;DROP TABLE dbo.Royalty_Cube_RewardProgram;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;Royalty_Cube_RewardProgram&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramID&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;NVARCHAR(50)&#x9;NULL&#xA;&#x9;&#x9;&#x9;);&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;INSERT INTO dbo.Royalty_Cube_RewardProgram&#xA;&#x9;&#x9;&#x9;(&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;&#x9;RewardProgramName&#xA;&#x9;&#x9;&#x9;)&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;SELECT &#x9;distinct(a.ID)&#x9;&#x9;&#x9;&#x9;AS&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;b.PromoDesc&#x9;&#x9;&#x9;&#x9;&#x9;AS&#x9;RewardProgramName&#xA;&#x9;  FROM &#x9;PromoDetails a,&#xA;&#x9;&#x9;&#x9;PromoDesc b&#xA;&#x9; WHERE&#x9;((a.ID&#x9;&#x9;BETWEEN&#x9;&#x9;40&#x9;&#x9;AND&#x9;&#x9;49)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;OR&#x9;&#x9;&#x9;a.ID&#x9;=&#x9;&#x9;303)&#xA;&#x9;   AND&#x9;a.ID&#x9;&#x9;=&#x9;&#x9;&#x9;b.PromoID&#xA;&#xA;&#x9;UNION&#xA;&#xA;&#x9;SELECT&#x9;vbofqRewardProgramID&#x9;&#x9;AS&#x9;RewardProgramID,&#xA;&#x9;&#x9;&#x9;RewardProgramName&#x9;&#x9;&#x9;AS&#x9;RewardProgramName&#xA;&#x9;FROM&#x9;vbofqRewardProgram;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'dbo.Royalty_Cube_CheckCount'))&#xA;DROP TABLE dbo.Royalty_Cube_CheckCount;&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;CREATE TABLE&#x9;Royalty_Cube_CheckCount&#xA;&#x9;&#x9;&#x9;(&#x9;IdentCol&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;IDENTITY,&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;Salesmixdate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;ActivationDate&#x9;&#x9;&#x9;VARCHAR(30)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;Storeid&#x9;&#x9;&#x9;&#x9;&#x9;VARCHAR(5)&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;CheckNumber&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL,&#xA;&#x9;&#x9;&#x9;&#x9;CheckCount&#x9;&#x9;&#x9;&#x9;INT&#x9;&#x9;&#x9;&#x9;NULL&#xA;&#x9;&#x9;&#x9;);&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;INSERT INTO dbo.Royalty_Cube_CheckCount&#xA;&#x9;&#x9;&#x9;(&#x9;Salesmixdate,&#xA;&#x9;&#x9;&#x9;&#x9;ActivationDate,&#xA;&#x9;&#x9;&#x9;&#x9;Storeid,&#xA;&#x9;&#x9;&#x9;&#x9;CheckNumber,&#xA;&#x9;&#x9;&#x9;&#x9;CheckCount&#xA;&#x9;&#x9;&#x9;)&#xA;--------------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;SELECT  convert(varchar, ActivityDateTime, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS Salesmixdate,&#xA;&#x9;&#x9;&#x9;convert(varchar, ActivityDateTime, 112)&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS ActivationDate,&#xA;&#x9;&#x9;&#x9;RIGHT(REPLICATE('0',3) + CONVERT(VARCHAR, FKStoreID) ,3)&#x9;AS Storeid,&#xA;&#x9;&#x9;&#x9;CheckNumber&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS CheckNumber,&#xA;&#x9;&#x9;&#x9;1&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AS CheckCount&#x9;&#x9;&#x9;&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;FROM &#x9;hstvbofqassignment&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;&#x9;WHERE&#x9;[Status]&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;=&#x9;&#x9;4&#xA;&#x9;  AND&#x9;CONVERT(DATE, DateOfBusiness)&#x9;&#x9;&#x9;&#x9;&gt;&#x9;&#x9;CONVERT(DATE, (GETDATE()-397))&#xA;&#x9;----------------------------------------------------------------------------------------------------------------------------&#xA;GROUP BY&#x9;convert(varchar, DateofBusiness, 112),&#xA;&#x9;&#x9;&#x9;convert(varchar, ActivityDateTime, 112),&#xA;&#x9;&#x9;&#x9;RIGHT(REPLICATE('0',3) + CONVERT(VARCHAR, FKStoreID) ,3),&#xA;&#x9;&#x9;&#x9;CheckNumber;&#xA;&#xA;--==============================================================================================================================&#xA;&#xA;GO&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Send End Note"
      DTS:CreationName="Microsoft.SqlServer.Dts.Tasks.SendMailTask.SendMailTask, Microsoft.SqlServer.SendMailTask, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91"
      DTS:Description="Send Mail Task"
      DTS:Disabled="True"
      DTS:DTSID="{9eb1c07c-f92d-4449-9aeb-b7b9aa66955c}"
      DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.SendMailTask.SendMailTask, Microsoft.SqlServer.SendMailTask, Version=11.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91"
      DTS:LocaleID="-1"
      DTS:ObjectName="Send End Note"
      DTS:TaskContact="Send Mail Task; Microsoft Corporation; Microsoft SQL Server v9; © 2004 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SendMailTask:SendMailTaskData
          SendMailTask:SMTPServer="{40B3A907-2FA2-4037-90FA-29573698AF5B}"
          SendMailTask:From="autoadmin@redrobin.com"
          SendMailTask:To="imoncivais@redrobin.com"
          SendMailTask:Subject="Loyalty Cube - Preparation Completed"
          SendMailTask:MessageSource="&#xA;FYI&#xA;&#xA;&#xA;&#xA;The preparation step of Loyalty Cube ETL packages completed sucessfully:&#xA;&#xA;&#xA;     -     Extra Large data sets have been copied&#xA;&#xA;     -     Pre-Calculation tables have been re-created&#xA;&#xA;     -     Cube Merit and Loyalty tables have been re-calculated&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;.it Solutions - Data Assets&#xA;&#xA;&#xA;" xmlns:SendMailTask="www.microsoft.com/sqlserver/dts/tasks/sendmailtask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint]"
      DTS:CreationName=""
      DTS:DTSID="{D3CED290-0D63-449B-8F7E-4ED83E47E854}"
      DTS:From="Package\Create Cube Data"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint"
      DTS:To="Package\Send End Note" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="sql11">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="163,42"
          Id="Package\Create Cube Data"
          TopLeft="67,26" />
        <NodeLayout
          Size="151,42"
          Id="Package\Send End Note"
          TopLeft="67,128" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint]"
          TopLeft="145.5,68">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,60"
              Start="0,0"
              End="0,52.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,52.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>